
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>The numerical tower and type coercion &#8212; mp++ 0.12 documentation</title>
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.12',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Common operators" href="tutorial_commonops.html" />
    <link rel="prev" title="Input and output" href="tutorial_io.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial_commonops.html" title="Common operators"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial_io.html" title="Input and output"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mp++ 0.12 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="tutorial.html" accesskey="U">Tutorial</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-numerical-tower-and-type-coercion">
<span id="tutorial-numtower"></span><h1>The numerical tower and type coercion<a class="headerlink" href="#the-numerical-tower-and-type-coercion" title="Permalink to this headline">¶</a></h1>
<p>Before proceeding to show how mp++’s classes can be used to perform arithmetic computations,
it is useful to introduce first the hierarchy on top of which mp++’s type coercion
is built.</p>
<p>In a broad sense, mp++ aims to extend C++’s type hierarchy with multiprecision
numerical types. In C++, when numerical operands of different types are involved
in an arithmetic operation, all operands are converted (or <em>coerced</em>) into a
common type determined from the types of the operands. The converted operands
are then used in place of the original operands to perform the operation,
and the type of the result will be the common type. For instance:</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">5l</span><span class="p">;</span>   <span class="c1">// &#39;4&#39; is int, &#39;5l&#39; is long: a will be long.</span>
<span class="k">auto</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">4.f</span> <span class="o">+</span> <span class="mi">5l</span><span class="p">;</span> <span class="c1">// &#39;4.f&#39; is float, &#39;5l&#39; is long: b will be float.</span>
<span class="k">auto</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">4.f</span> <span class="o">+</span> <span class="mf">5.</span><span class="p">;</span> <span class="c1">// &#39;4.f&#39; is float, &#39;5.&#39; is double: c will be double.</span>
</pre></div>
</div>
<p>In order to determine the common type, C++ assigns a rank to each fundamental type.
In an operation involving operands of different types, the type of the result will be
the type with the highest rank among the types of the operands. Although there are
a few complications and caveats, the general rule in C++ is that integral types have
a lower rank than floating-point types, and that, within the integral and floating-point
types, a higher range or bit width translates to a higher rank. The underlying
idea is that automatic type coercion should not change the value of an operand <a class="footnote-reference" href="#f1" id="id1">[1]</a>.</p>
<p>mp++ extends C++’s type hierarchy in a (hopefully) natural way:</p>
<ul class="simple">
<li><a class="reference internal" href="integer.html#_CPPv2N4mppp7integerE" title="mppp::integer"><code class="xref cpp cpp-class docutils literal"><span class="pre">integer</span></code></a> has a rank higher than any C++ integral type, but lower
than any C++ floating-point type;</li>
<li><a class="reference internal" href="rational.html#_CPPv2N4mppp8rationalE" title="mppp::rational"><code class="xref cpp cpp-class docutils literal"><span class="pre">rational</span></code></a> has a rank higher than <a class="reference internal" href="integer.html#_CPPv2N4mppp7integerE" title="mppp::integer"><code class="xref cpp cpp-class docutils literal"><span class="pre">integer</span></code></a>, but lower
than any C++ floating-point type;</li>
<li><a class="reference internal" href="real128.html#_CPPv2N4mppp7real128E" title="mppp::real128"><code class="xref cpp cpp-class docutils literal"><span class="pre">real128</span></code></a> has a rank higher than any C++ floating-point type;</li>
<li><a class="reference internal" href="real.html#_CPPv2N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal"><span class="pre">real</span></code></a> has a rank higher than <a class="reference internal" href="real128.html#_CPPv2N4mppp7real128E" title="mppp::real128"><code class="xref cpp cpp-class docutils literal"><span class="pre">real128</span></code></a>.</li>
</ul>
<p>In other words, mp++’s type hierarchy (or <em>numerical tower</em>) from the lowest rank to the highest is the following:</p>
<ul class="simple">
<li>C++ integral types,</li>
<li><a class="reference internal" href="integer.html#_CPPv2N4mppp7integerE" title="mppp::integer"><code class="xref cpp cpp-class docutils literal"><span class="pre">integer</span></code></a>,</li>
<li><a class="reference internal" href="rational.html#_CPPv2N4mppp8rationalE" title="mppp::rational"><code class="xref cpp cpp-class docutils literal"><span class="pre">rational</span></code></a>,</li>
<li>C++ floating-point types,</li>
<li><a class="reference internal" href="real128.html#_CPPv2N4mppp7real128E" title="mppp::real128"><code class="xref cpp cpp-class docutils literal"><span class="pre">real128</span></code></a>,</li>
<li><a class="reference internal" href="real.html#_CPPv2N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal"><span class="pre">real</span></code></a>.</li>
</ul>
<p>Note that up to and including <a class="reference internal" href="rational.html#_CPPv2N4mppp8rationalE" title="mppp::rational"><code class="xref cpp cpp-class docutils literal"><span class="pre">rational</span></code></a>, types with higher rank can represent exactly all values
of any type with a lower rank. The floating-point types, however, cannot represent exactly all values representable
by <a class="reference internal" href="rational.html#_CPPv2N4mppp8rationalE" title="mppp::rational"><code class="xref cpp cpp-class docutils literal"><span class="pre">rational</span></code></a>, <a class="reference internal" href="integer.html#_CPPv2N4mppp7integerE" title="mppp::integer"><code class="xref cpp cpp-class docutils literal"><span class="pre">integer</span></code></a> or even the C++ integral types. It should also be noted
that <a class="reference internal" href="real.html#_CPPv2N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal"><span class="pre">real</span></code></a>’s precision is set at runtime, and it is thus possible to create <a class="reference internal" href="real.html#_CPPv2N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal"><span class="pre">real</span></code></a>
objects with a precision lower than <a class="reference internal" href="real128.html#_CPPv2N4mppp7real128E" title="mppp::real128"><code class="xref cpp cpp-class docutils literal"><span class="pre">real128</span></code></a> or any of the C++ floating-point types. Regardless,
when it comes to type coercion, <a class="reference internal" href="real.html#_CPPv2N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal"><span class="pre">real</span></code></a> is always assigned a rank higher than any other type.</p>
<p>mp++’s type coercion rules extend beyond arithmetic operators. The exponentiation functions <code class="docutils literal"><span class="pre">pow()</span></code>, for instance,
also use the type hierarchy to determine the type of the result. Type coercion is also applied in the comparison operators,
where arguments of different types are promoted to the common type before actually carrying out the comparison.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Strictly speaking, this is of course not true. On modern architectures, a large enough
64-bit <code class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></code> will be subject to a lossy conversion to, e.g., <code class="docutils literal"><span class="pre">float</span></code>
during type coercion.</td></tr>
</tbody>
</table>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial_io.html"
                        title="previous chapter">Input and output</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tutorial_commonops.html"
                        title="next chapter">Common operators</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial_commonops.html" title="Common operators"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial_io.html" title="Input and output"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mp++ 0.12 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="tutorial.html" >Tutorial</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2018, Francesco Biscani.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>